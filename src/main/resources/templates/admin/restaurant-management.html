<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/layout}">
<head>
    <title>식당 및 메뉴 관리</title>
</head>
<body>
<div layout:fragment="content">
    <h1>식당 및 메뉴 관리</h1>
    <div class="tab-container">
        <div class="tabs">
            <div class="tab active" data-tab="restaurant-list">식당 목록</div>
            <div class="tab" data-tab="category-management">카테고리 관리</div>
        </div>

        <div class="tab-content active" id="restaurant-list">
            <div class="action-bar">
                <button class="primary-btn" id="add-restaurant-btn"><i class="fas fa-plus"></i> 새 식당 추가</button>
                <div class="search-filter">
                    <input type="text" placeholder="식당명 검색">
                    <button class="search-btn"><i class="fas fa-search"></i></button>
                </div>
                <div class="filter-options">
                    <select id="restaurant-category-filter">
                        <option value="all">모든 카테고리</option>
                        <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}">한식</option>
                    </select>
                    <select id="restaurant-sort">
                        <option value="name">이름순</option>
                        <option value="rating">평점순</option>
                        <option value="newest">최신순</option>
                    </select>
                </div>
            </div>

            <!-- 테이블 형태로 변경 -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>식당명</th>
                        <th>카테고리</th>
                        <th>주소</th>
                        <th>전화번호</th>
                        <th>대표 메뉴</th>
                        <th>평균 평점</th>
                        <th>액션</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="restaurant : ${page.content()}">
                        <td th:text="${restaurant.restaurantId}"></td>
                        <td th:text="${restaurant.name}"></td>
                        <td><span class="badge" th:text="${restaurant.category}"></span></td>
                        <td th:text="${restaurant.address}"></td>
                        <td th:text="${restaurant.tel}"></td>
                        <td th:text="${restaurant.mainFood}"></td>
                        <td>
                            <div class="rating">
                                <span th:text="${#numbers.formatDecimal(((restaurant.googleRating + restaurant.naverRating + restaurant.kakaoRating) / 3), 1, 1)}"></span>
                            </div>
                        </td>
                        <td>
                            <button class="action-btn edit" th:data-id="${restaurant.restaurantId}"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete" th:data-id="${restaurant.restaurantId}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div th:replace="~{admin/fragments/pagination :: pagination}"></div>
        </div>

        <!-- 카테고리 관리 탭 -->
        <div class="tab-content" id="category-management">
            <div class="action-bar">
                <button class="primary-btn" id="add-category-btn"><i class="fas fa-plus"></i> 새 카테고리 추가</button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>카테고리명</th>
                        <th>식당 수</th>
                        <th>생성일</th>
                        <th>액션</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="category : ${categories}">
                        <td th:text="${category.id}">1</td>
                        <td th:text="${category.name}">한식</td>
                        <td th:text="${category.restaurantCount}">24</td>
                        <td th:text="${#temporals.format(category.createdAt, 'yyyy-MM-dd')}">2023-01-15</td>
                        <td>
                            <button class="action-btn edit" th:data-id="${category.id}"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete" th:data-id="${category.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                    <!-- 기본 데이터 (서버에서 데이터가 없을 경우) -->
                    <tr th:if="${categories == null || categories.isEmpty()}">
                        <td>1</td>
                        <td>한식</td>
                        <td>24</td>
                        <td>2023-01-15</td>
                        <td>
                            <button class="action-btn edit"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 식당 추가/수정 모달 (개선) -->
    <div class="modal" id="restaurantModal">
        <div class="modal-content large-modal">
            <div class="modal-header">
                <h2 id="restaurant-modal-title">식당 추가</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="restaurantForm">
                    <input type="hidden" id="restaurant-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="restaurant-name">식당명 <span class="required">*</span></label>
                            <input type="text" id="restaurant-name" required>
                        </div>
                        <div class="form-group">
                            <label for="restaurant-category">카테고리 <span class="required">*</span></label>
                            <select id="restaurant-category" required>
                                <option value="">카테고리 선택</option>
                                <option value="한식">한식</option>
                                <option value="중식">중식</option>
                                <option value="일식">일식</option>
                                <option value="양식">양식</option>
                                <option value="분식">분식</option>
                                <option value="디저트">디저트</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="restaurant-address">주소 <span class="required">*</span></label>
                        <input type="text" id="restaurant-address" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="restaurant-phone">전화번호</label>
                            <input type="text" id="restaurant-phone">
                        </div>
                        <div class="form-group">
                            <label for="restaurant-hours">영업 시간</label>
                            <input type="text" id="restaurant-hours" placeholder="예: 평일 11:00-22:00, 주말 11:00-23:00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="restaurant-main-menu">대표 메뉴</label>
                            <input type="text" id="restaurant-main-menu" placeholder="대표 메뉴를 입력하세요">
                        </div>
                        <div class="form-group">
                            <label for="restaurant-price-range">가격대</label>
                            <select id="restaurant-price-range">
                                <option value="">가격대 선택</option>
                                <option value="저렴">저렴 (1만원 미만)</option>
                                <option value="보통">보통 (1-3만원)</option>
                                <option value="고급">고급 (3만원 이상)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="restaurant-description">식당 설명</label>
                        <textarea id="restaurant-description" rows="3" placeholder="식당에 대한 간략한 설명을 입력하세요"></textarea>
                    </div>

                    <div class="form-group">
                        <label>분위기 (해당하는 항목 모두 선택)</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-clean" name="restaurant-mood" value="청결한">
                                <label for="mood-clean">청결한</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-spacious" name="restaurant-mood" value="매장이 넓은">
                                <label for="mood-spacious">매장이 넓은</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-quiet" name="restaurant-mood" value="조용한">
                                <label for="mood-quiet">조용한</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-lively" name="restaurant-mood" value="활기찬">
                                <label for="mood-lively">활기찬</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-romantic" name="restaurant-mood" value="로맨틱한">
                                <label for="mood-romantic">로맨틱한</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-modern" name="restaurant-mood" value="모던한">
                                <label for="mood-modern">모던한</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-traditional" name="restaurant-mood" value="전통적인">
                                <label for="mood-traditional">전통적인</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-family" name="restaurant-mood" value="가족 친화적">
                                <label for="mood-family">가족 친화적</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-group" name="restaurant-mood" value="단체 모임">
                                <label for="mood-group">단체 모임</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mood-view" name="restaurant-mood" value="전망 좋은">
                                <label for="mood-view">전망 좋은</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="restaurant-menu-items">메뉴 항목</label>
                        <div id="menu-items-container">
                            <div class="menu-item">
                                <input type="text" class="menu-name" placeholder="메뉴명">
                                <input type="text" class="menu-price" placeholder="가격">
                                <button type="button" class="remove-menu-btn"><i class="fas fa-times"></i></button>
                            </div>
                        </div>
                        <button type="button" class="add-menu-btn secondary-btn"><i class="fas fa-plus"></i> 메뉴 추가</button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn cancel-btn">취소</button>
                <button class="primary-btn save-btn">저장</button>
            </div>
        </div>
    </div>

    <!-- 카테고리 추가/수정 모달 -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="category-modal-title">카테고리 추가</h2>
                <span class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="categoryForm">
                    <input type="hidden" id="category-id">
                    <div class="form-group">
                        <label for="category-name">카테고리명</label>
                        <input type="text" id="category-name" required>
                    </div>
                    <div class="form-group">
                        <label for="category-description">설명</label>
                        <textarea id="category-description" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn cancel-btn">취소</button>
                <button class="primary-btn save-btn">저장</button>
            </div>
        </div>
    </div>
</div>

<th:block layout:fragment="script">
    <script th:src="@{/js/restaurant-management.js}"></script>
</th:block>
</body>
</html>